(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19],{3759:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});let r=(0,n(945).UU)("https://pcgzotcxksuwzrdombpd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBjZ3pvdGN4a3N1d3pyZG9tYnBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NzUxOTUsImV4cCI6MjA3MzM1MTE5NX0.r22dQt1IFMnvefMQc-yqqb7bsE9aPW4U_09-OFXX_Xs")},4776:(e,t,n)=>{Promise.resolve().then(n.bind(n,6246))},6246:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(5155),s=n(2115),i=n(7983),o=n(9324),a=n(9142),l=n(9141),c=n(5239),u=n(1670),d=n.n(u),p=n(63),v=n(5125),g=n(3759);let m=function(){var e;let{interviewInfo:t,setInterviewInfo:n}=(0,s.useContext)(i.$)||{interviewInfo:{userName:"Guest",interviewData:{questionList:[{question:"What is your experience?"},{question:"Why do you want this job?"}]}},setInterviewInfo:()=>{}},u=(0,s.useRef)(null),[m,h]=(0,s.useState)(!1),[f,w]=(0,s.useState)(0),[x,b]=(0,s.useState)(!1),y=(0,s.useRef)(null),I=(0,p.useRouter)(),[j,N]=(0,s.useState)(!1),[k,q]=(0,s.useState)(!1),E=(0,s.useRef)(null),S=(0,s.useRef)(null),M=(0,s.useRef)([]),{interview_Id:A}=(0,p.useParams)();(0,s.useEffect)(()=>{console.log("Initializing Vapi...");try{u.current=new(d())("d4f8f11d-65fe-4092-878a-92a9a8d1a3b5"),console.log("Vapi initialized successfully:",u.current)}catch(e){console.error("Failed to initialize Vapi:",e.message);return}u.current.on("call-start",()=>{console.log("Call started event triggered"),h(!0),C(),M.current=[]}),u.current.on("call-end",async()=>{console.log("Call ended event triggered"),h(!1),z(),n(e=>({...e,isInterviewActive:!1})),N(!1),q(!1),T(),console.log("Full conversation:",M.current),await D(M.current)}),u.current.on("message",e=>{if(console.log("Message received:",e),"transcript"===e.type){let t={role:e.role,transcript:e.transcript};M.current.push(t),console.log("".concat(e.role||"unknown",": ").concat(e.transcript)),"assistant"===e.role?(N(!0),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{N(!1)},2e3)):(q(!0),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{q(!1)},2e3))}}),u.current.on("error",e=>{console.error("Vapi error event:",JSON.stringify(e,null,2)),"start-method-error"===e.code&&(console.error("Start method failed. Possible causes: invalid assistant ID, API key, or serverMessage configuration."),e.message&&console.error("Error message:",e.message))})},[n]),(0,s.useEffect)(()=>{u.current&&(console.log("Checking interviewInfo in useEffect:",t),t&&!m?(console.log("Starting call with interviewInfo:",t),P()):t||(console.warn("interviewInfo is undefined, using fallback"),P()))},[t,m]);let C=()=>{y.current||(y.current=setInterval(()=>{w(e=>e+1)},1e3))},z=()=>{y.current&&(clearInterval(y.current),y.current=null)},D=async e=>{if(!e||0===e.length){console.log("No conversation data available for feedback."),I.replace("/interview/completed");return}let r="";try{var s;let i=await v.A.post("/api/ai-feedback",{conversation:e});console.log("Feedback generated:",null==i?void 0:i.data),r=(null==i||null==(s=i.data)?void 0:s.content).replace(/^```json/,"").replace(/```$/,"").trim(),console.log("Cleaned Feedback Content:",r),n(e=>({...e,feedback:r}));let o=r;try{o=JSON.parse(r)}catch(e){console.warn("Feedback is not valid JSON, inserting as string:",e),o=r}let{data:a,error:l}=await g.N.from("interview-feedback").insert([{userName:null==t?void 0:t.userName,userEmail:null==t?void 0:t.userEmail,interview_Id:A,feedback:o,recommended:!1}]).select();console.log("Inserted data:",a),l&&console.error("Supabase insert error:",l)}catch(e){console.error("Error generating feedback:",e),r=""}finally{I.replace("/interview/"+A+"/completed")}},P=()=>{var e,n,r,s,i;if(!u.current)return void console.error("Vapi instance is not initialized or not on client");let o="";(null==t||null==(e=t.interviewData)?void 0:e.questionList)&&Array.isArray(null==t||null==(n=t.interviewData)?void 0:n.questionList)?o=null==t||null==(i=t.interviewData)?void 0:i.questionList.filter(e=>null==e?void 0:e.question).map(e=>e.question).join(", "):(console.warn("No valid interviewData.questionList found, using fallback"),o="What is your experience?, Why do you want this job?"),console.log("Constructed questionList:",o);let a={name:"AI Interviewer",model:{provider:"openai",model:"gpt-4",messages:[{role:"system",content:'\n            You are an AI voice assistant conducting interviews.\n            Your job is to ask candidates provided interview questions, assess their responses.\n            Begin the conversation with a friendly introduction, setting a relaxed yet professional tone. Example:\n            "Hey there! Welcome to your '.concat(null==t||null==(r=t.interviewData)?void 0:r.jobPosition,' interview. Let’s get started with a few questions!"\n\n            Ask one question at a time and wait for the candidate’s response before proceeding. Keep the questions clear and concise. Below Are the questions ask one by one:\n            Questions: ').concat(o,'\n\n            Keep the conversation natural and engaging–use casual phrases like "Alright, next up…" or "Let’s tackle a tricky one!"\n            After 5–7 questions, wrap up the interview smoothly by summarizing their performance. Example:\n            "That was great! You handled some tough questions well. Keep sharpening your skills!"\n\n            End on a positive note:\n            "Thanks for chatting! Hope to see you crushing projects soon!"\n\n            Key Guidelines:\n            ✅ Be friendly, engaging, and witty\n            ✅ Keep responses short and natural, like a real conversation\n            ✅ Adapt based on the candidate’s confidence level\n            ✅ Ensure the interview remains focused on React\n        ').trim()}]},voice:{provider:"playht",voiceId:"jennifer"},transcriber:{provider:"deepgram",model:"nova-2",language:"en-US"},firstMessage:"Hi ".concat(null==t?void 0:t.userName,", how are you? Ready for your interview on ").concat(null==t||null==(s=t.interviewData)?void 0:s.jobPosition,"?")};navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>{console.log("Microphone access granted");try{u.current.start(a),console.log("Call start attempted with dynamic assistant")}catch(e){console.error("Error starting call:",e.message)}}).catch(e=>{console.error("Microphone access denied or error:",e),alert("Please allow microphone access to start the interview.")})},T=()=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{e.getTracks().forEach(e=>e.stop()),console.log("Microphone stream stopped")}).catch(e=>console.error("Error stopping media stream:",e))},U=(null==t?void 0:t.userName)?t.userName[0].toUpperCase():"U";return(0,r.jsxs)("div",{className:"p-20 lg:px-48 xl:px-56",children:[(0,r.jsx)("style",{children:"\n                    @keyframes pulse {\n                        0% { transform: scale(1); opacity: 0.6; }\n                        50% { transform: scale(1.2); opacity: 0.3; }\n                        100% { transform: scale(1); opacity: 0.6; }\n                    }\n                    .pulse-ring {\n                        position: absolute;\n                        inset: 0;\n                        border-radius: 9999px;\n                        border: 4px solid;\n                        background: rgba(255, 255, 255, 0.2);\n                        animation: pulse 1.5s ease-in-out infinite;\n                    }\n                "}),(0,r.jsxs)("h2",{className:"font-semibold text-sm",children:["(",(null==t||null==(e=t.interviewData)?void 0:e.jobPosition)||"Loading...",")"]}),(0,r.jsxs)("h2",{className:"font-bold text-xl flex items-center justify-between",children:["AI - Interview Session",(0,r.jsxs)("span",{className:"flex gap-2 items-center",children:[(0,r.jsx)(o.A,{}),(e=>{let t=Math.floor(e/3600),n=Math.floor(e%3600/60);return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(f)]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-7 mt-5",children:[(0,r.jsxs)("div",{className:"bg-white h-[300px] rounded-lg border flex flex-col justify-center items-center relative",children:[(0,r.jsxs)("div",{className:"relative",children:[j&&(0,r.jsx)("span",{className:"pulse-ring border-green-500"}),(0,r.jsx)(c.default,{src:"/ai.jpeg",alt:"AI",width:100,height:100,className:"w-[60px] h-[60px] rounded-full object-cover z-10 relative"})]}),(0,r.jsx)("h2",{className:"text-sm font-semibold mt-2 z-10 relative",children:"AI Interviewer"})]}),(0,r.jsxs)("div",{className:"bg-white h-[300px] rounded-lg border flex flex-col justify-center items-center relative",children:[(0,r.jsxs)("div",{className:"relative",children:[k&&(0,r.jsx)("span",{className:"pulse-ring border-blue-500"}),(0,r.jsx)("h2",{className:"text-2xl bg-primary text-white p-3 rounded-full px-6 z-10 relative",children:U})]}),(0,r.jsx)("h2",{className:"text-sm mt-2 font-semibold z-10 relative",children:(null==t?void 0:t.userName)||"Guest"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 mt-7",children:[(0,r.jsx)(a.A,{className:"w-12 h-12 rounded-full text-white p-3 cursor-pointer transition-colors ".concat(x?"bg-gray-500":"bg-green-500"),onClick:()=>{u.current&&u.current.mute&&(u.current.mute(!x),b(e=>!e),console.log("Mic toggled:",!x))}}),(0,r.jsx)(l.A,{className:"w-12 h-12 rounded-full bg-red-500 text-white p-3 cursor-pointer",onClick:()=>{u.current&&m&&(console.log("Ending call..."),u.current.mute&&(u.current.mute(!0),console.log("Microphone muted")),u.current.stop(),u.current=null,h(!1),z(),w(0),n(e=>({...e,isInterviewActive:!1})),N(!1),q(!1),T(),setTimeout(()=>{I.push("/interview/"+(null==t?void 0:t.interviewId)+"/completed"),console.log("Redirected to /interview/completed")},500))}})]}),(0,r.jsx)("h2",{className:"text-center text-sm text-gray-500 mt-4",children:m?"Interview in progress...":"Starting interview..."})]})}},7983:(e,t,n)=>{"use strict";n.d(t,{$:()=>i,InterviewDataProvider:()=>o});var r=n(5155),s=n(2115);let i=(0,s.createContext)({interviewInfo:{userName:"",jobPosition:"",duration:"",type:"",interviewData:{questionList:[]}},setInterviewInfo:()=>{}});function o(e){let{children:t}=e,[n,o]=(0,s.useState)({userName:"Test User",jobPosition:"Developer",duration:"30 Min",type:"Technical",interviewData:{questionList:[{question:"What is your experience?"},{question:"Why do you want this job?"}]}});return(0,s.useEffect)(()=>{console.log("Context interviewInfo initialized in provider:",n)},[n]),(0,r.jsx)(i.Provider,{value:{interviewInfo:n,setInterviewInfo:o},children:t})}}},e=>{e.O(0,[424,945,356,495,441,255,358],()=>e(e.s=4776)),_N_E=e.O()}]);